# SQL과 NOSQL의 차이

## SQL(관계형 DB)

* SQL을 사용하면 RDBMS에서 데이터를 저장, 수정, 삭제 및 검색을 할 수 있다.
* 관계형 데이터베이스에는 핵심적인 두 가지 특성이 있다.
  * 데이터는 **정해진 데이터 스키마에 따라 테이블에 저장**된다.
  * 데이터는 **관계를 통해 여러 테이블에 분산**된다.
* 데이터는 테이블에 레코드로 저장되는데, 각 테이블마다 명확하게 정의된 구조가 있다. 해당 구조는 필드의 이름과 데이터 유형으로 정의된다.
* 따라서 **스키마를 준수하지 않은 레코드는 테이블에 추가할 수 없다.** 즉, 스키마를 수정하지 않는 이상은 정해진 구조에 맞는 레코드만 추가가 가능한 것이 관계형 데이터베이스의 특징 중 하나이다.
* 또한, 데이터의 중복을 피하기 위해 '관계'를 이용한다.

![](https://t1.daumcdn.net/cfile/tistory/994D09355C937ECD2D)

* 하나의 테이블에서 중복 없이 하나의 데이터만을 관리하기 때문에 다른 테이블에서 부정확한 데이터를 다룰 위험이 없어지는 장점이 있다.

<br/>

## NoSQL(비관계형 DB)
### 정의

관계형 데이터 모델을 **지양**하며 대량의 분산된 데이터를 저장하고 조회하는 데 특화되어으며 스키마 없이 사용 가능하거나 느슨한 스키마를 제공하는 저장소를 말한다. 즉, 관계형 DB와는 반대로 스키다도 없고, 관계도 없다. SQL과 핵심적인 차이로는 SQL은 정해진 스키마를 따르지 않으면 데이터가 추가가 불가능 했는데, NoSQL에서는 다른 구조의 데이터를 같은 컬렉션에 추가가 가능하다.

종류마다 쓰기/읽기 성능 특화, 2차 인덱스 지원, 오토 샤딩 지원 같은 고유한 특징을 가진다. 대량의 데이터를 빠르게 처리하기 위해 메모리에 임시 저장하고 응답하는 등의 방법을 사용한다. 동적인 스케일 아웃을 지원하기도 하며, 가용성을 위하여 데이터 복제 등의 방법으로 관계형 데이터베이스가 제공하지 못하는 성능과 특징을 제공한다.

<br/>

### CAP 이론

1. **일관성(Consistency)**

일관성은 동시성 또는 동일성이라고도 하며 다중 클라이언트에서 같은 시간에 조회하는 데이터는 항상 동일한 데이터임을 보장하는 것을 의미한다. 이것은 관계형 데이터베이스가 지원하는 가장 기본적인 기능이지만 일관성을 지원하지 않는 NoSQL을 사용한다면 데이터 일관성이 느슨하게 처리되며 동일한 데이터가 나타나지 않을 수 있다. 느슨하게 처리된다는 것은 데이터의 변경을 시간의 흐름에 따라 여러 노드에 전하나는 것을 말한다. 이러한 방법을 최종적으로 일관성이 유지된다고 하여 최종 일관성 또는 궁극적 일관성을 지원한다고 한다.

각 NoSQL 들은 분산 노드 간의 데이터 동기화를 위해서 두 가지 방법을 사용한다. 첫 번째로 데이터의 저장 결과를 클라이언트로 응답하기 전에 모든 노드에 데이터를 저장하는 동기식 방법이 있다. 그만큼 느린 응답시간을 보이지만 데이터의 정합성을 보장한다. 두 번째로 메모리나 임시 파일에 기록하고 클라이언트에 먼저 응답한 다음, 특정 이벤트 또는 프로세스를 사용하여 노드로 데이터를 동기화하는 비동기식 방법이 있다. 빠른 응답시간을 보인다는 장점이 있지만, 쓰기 노드에 장애가 발생하였을 경우 데이터가 손상될 수 있다.

<br/>

2. **가용성(Availabliity)**

가용성이란 모든 클라이언트의 읽기와 쓰기 요청에 대하여 항상 응답이 가능해야 함을 보장하는 것이며 내고장성이라고도 한다. 내고장성을 가진 NoSQL 은 클러스터 내에서 몇 개의 노드가 망가지더라도 정상적인 서비스가 가능하다.

몇몇 NoSQL 은 가용성을 보장하기 위해 데이터 복제(Replication)을 사용한다. 동일한 데이터를 다중 노드에 중복 저장하여 그 중 몇 대의 노드가 고장나도 데이터가 유실되지 않도록 하는 방법이다. 데이터 중복 저장 방법에는 동일한 데이터를 가진 저장소를 하나 더 생성하여 Master-Slave 복제 방법과 데이터 단위로 중복 저장하는 Peer-to-Peer 복제 방법이 있다.

<br/>

3. **네트워크 분할 허용성(Partition tolerance)**

분할 허용성이란 지역적으로 분할된 네트워크 환경에서 동작하는 시스템은 두 지역 간의 네트워크가 단절되거나 네트워크 데이터의 유실이 일어나더라도 각 지역 내의 시스템은 정상적으로 동작해야 함을 의미한다.

<br/>

### 저장 방식에 따른 NoSQL 분류
`Key-Value Model`, `Document Model`, `Column Model`, `Graph Model`로 분류할 수 있다.

1. **Key-Value Model**

가장 기본적인 형태의 NoSQL 이며 키 하나로 데이터 하나를 저장하고 조회할 수 있는 단일 키-값 구조를 갖는다. 단순한 저장구조로 인하여 복잡한 조회 연산을 지원하지 않는다. 또한 고속 읽기와 쓰기에 최적화된 경우가 많다. 사용자의 프로필 정보, 웹 서버 클러스터를 위한 세션 정보, 장바구니 정보, URL, 단축 정보 등에 사용한다. 하나의 서비스 요청에 다수의 데이터 조회 및 수정 연산이 발생하면 트랜잭션 처리가 불가능하여 데이터의 정합성을 보장할 수 없다. (Ex. Redis)

<br/>

2. Document Model

키-값 모델을 개념적으로 확장한 구조로 하나의 키에 하나의 구조화된 문서를 저장하고 조회한다. 논리적인 데이터 저장과 조회 방법이 관계형 데이터베이스와 유사하다. 키는 문서에 대한 ID로 표현된다. 또한 저장된 문서를 컬렉션으로 관리하며 문서 저장과 동시에 문서 ID에 대한 인덱스를 생성한다. 문서 ID에 대한 인덱스를 사용하여 O(1) 시간 안에 문서를 조회할 수 있다.

대부분의 문서 모델 NoSQL은 B 트리 인덱스를 사용하여 2차 인덱스를 생성한다. B 트리는 크기가 커지면 커질수록 새로운 데이터를 입력하거나 삭제할 때 성능이 떨어지게 된다. 그렇기 때문에 읽기와 쓰기의 비율이 7:3 정도일 때 가장 좋은 성능을 보인다. 중앙 집중식 로그 저장, 타임라인 저장, 통계 정보 저장 등에 사용된다. (Ex. MongoDB)

<br/>

3. Column Model

하나의 키에 여러 개의 컬럼 이름과 컬럼 값의 쌍으로 이루어진 데이터를 저장하고 조회한다. 모든 컬럼은 항상 타임 스탬프 값과 함께 저장된다.

구글의 빅테이블이 대표적인 예로 차후 컬렴형 NoSQL은 빅테이블의 영향을 받았다. 이러한 이유로 Row Key, Column Key, Column Family 같은 빅테이블 개념이 공통적으로 사용된다. 저장의 기본 단위는 컬럼으로 컬럼은 컬럼 이름과 컬럼 값, 타임 스탬프로 구성된다. 이러한 컬럼들의 집합이 로우(Row)이며, 로우키(Row Key)는 각 로우를 유일하게 식별하는 값이다. 이러한 로우들의 집합은 키 스페이스(Key Space)가 된다.

대부분의 컬럼 모델 NoSQL은 쓰기와 읽기 중에 쓰기에 더 특화되어 있다. 데이터를 먼저 커밋로그와 메모리에 저장한 후 응답하기 떄문에 빠른 응답속도를 제공한다. 그렇기 때문에 읽기 연산 대비 쓰기 연산이 많은 서비스나 빠른 시간 안에 대량의 데이터를 입력하고 조회하는 서비스를 구현할 때 가장 좋은 성능을 보인다. 채팅 내용 저장, 실시간 분석을 위한 데이터 저장소 들의 서비스 구현에 적합하바.

<br/>

## SQL, NoSQL의 장점과 단점

### SQL 장점
* 명확하게 정의된 스키마, 데이터 무결성을 보장
* 관계는 각 데이터를 중복없이 한 번만 저장

<br/>

### SQL 단점
* 덜 유연하다. 데이터 스키마를 사전에 계획하고 알려야 한다(나중에 수정하기 힘들다).
* 관계를 맺고 있어서 조인문이 많은 복잡한 쿼리가 만들어질 수 있다.
* 대체로 수직적 확장만 간으하다.

<br/>

### NoSQL 장점
* 스키마가 없어서 유연하다. 언제든지 저장된 데이터를 조정하고 새로운 필드 추가가 가능하다.
* 데이터는 애플리케이션이 필요로 하는 형식으로 저장된다. 데이터 읽어오는 속도가 빨라진다.
* 수직 및 수평 확장이 가능해서 애플리케이션이 발생시키는 모든 읽기/쓰기 요청 처리가 가능하다.

<br/>

### NoSQL 단점
* 유연성으로 인해 데이터 구조 결정을 미루게 될 수 있다.
* 데이터 중복을 계속 업데이트 해야 한다.
* 데이터가 여러 컬렉션에 중복되어 있기 때문에 수정 시 모든 컬렉션에서 수행해야 한다.
<br/>
(SQL에서는 중복 데이터가 없으므로 한 번만 수행이 가능)

<br/>

## SQL 데이터베이스 사용이 더 좋을 때
* 관계를 맺고 있는 데이터가 자주 변경되는 애플리케이션의 경우
  * NoSQL에서는 여러 컬렉션을 모두 수정해야 하기 떄문에 비효율적이다.

* 변경될 여지가 없고, 명확한 스키마가 사용자와 데이터에게 중요한 경우

<br/>

## NoSQL 데이터베이스 사용이 더 좋을 때
* 정확한 데이터 구조를 알 수 없거나 변경/확장 될 수 있는 경우
* 읽기를 자주 하지만, 데이터 변경은 자주 없는 경우
* 데이터베이스를 수평으로 확장해야 하는 경우(막대한 양의 데이터를 다뤄야 하는 경우)

<br/>

## 결론

하나의 제시 방법이지 완전한 정답이 정해져 있는 것은 아니다.

SQL을 선택해서 복잡한 JOIN문을 만들지 않도록 설계하여 단점을 없앨 수도 있고

NoSQL을 선택해서 중복 데이터를 줄이는 방법으로 설계해서 단점을 없앨 수도 있다.

<br/>

**참조**
* [원본링크1](https://gyoogle.dev/blog/computer-science/data-base/SQL%20&%20NOSQL.html)
* [원본링크2](https://github.com/JaeYeopHan/Interview_Question_for_Beginner/tree/master/Database#%EC%A0%80%EC%9E%A5-%EB%B0%A9%EC%8B%9D%EC%97%90-%EB%94%B0%EB%A5%B8-nosql-%EB%B6%84%EB%A5%98)
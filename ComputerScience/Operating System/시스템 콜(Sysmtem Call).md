# 시스템 콜(System Call)

먼저, 커널 모드와 사용자 모드에 대해서 알아보겠다.

1. 커널 모드

    * 프로그램 카운터가 운영체제가 존재하는 부분을 가리키고 있다면, 현재 운영체제의 코드를 수행 중이며 CPU가 커널 모드에서 수행 중이라고 한다.

2. 사용자 모드

    * 프로그램 카운터가 사용자 프로그램이 존재하는 메모리 위치를 가리킬 경우, 사용자 프로그램을 수행 중이며 CPU가 사용자 모드에서 수행 중이라고 한다.

* 일반 명령 : 메모리에서 자료를 읽어와서 CPU에서 계산하고 결과를 메모리에 쓰는 일련의 명령들이다. 모든 프로그램이 수행할 수 있다(사용자 모드).

* 특권 명령 : 보안이 필요한 명령으로, 입출력 장치, 타이머 등 각종 장치를 접근하는 명령이다(커널 모드).

* CPU 내에 모드 비트를 두어 두 명령을 수행한다.

* 사용자 프로그램이 디스크의 파일을 접근하거나, 화면에 결과를 출력하는 등의 작업이 필요한 경우가 있다. 하지만, 이러한 작업은 특권 명령의 수행을 필요로 한다.

<br/>

## 시스템 콜 개념

시스템 콜은 **커널과 사용자 프로그램을 이어주는 인터페이스 역할** 을 한다. 사용자 프로그램이 디스크에 있는 파일을 여는 것은 파일 시스템에 접근한다는 의미다. 시스템에 접근하기 위해서는 커널 모드로 전환되어야 하는데, 이때 시스템 콜을 사용한다. 즉, 사용자 프로그램은 스스로 특권 명령을 수행할 수 없으므로 운영체제에서 특권 명령의 대행을 요청하는데 이러한 서비스 요청을 시스템 콜이라고 부른다(즉, 특권의 명령의 대행을 요청하여 사용자 프로그램이 커널 영역의 기능을 수행하게 해준다).

시스템 콜은 주로 C/C++과 같은 **High-level 언어** 로 작성된다. 실제로는 프로그램 이식성(Portability)과 사용의 편리함 때문에 직접적인 시스템 콜보단 **API(Application Program Interface)** 를 통해서 사용된다. 주로 사용하는 API는 Window에선 Win32, UNIX/Linux/Mac OS X 등에서는 POSIX-API, JVM(Java Virtual Machine)에서는 Java API가 있다.

각각의 시스템 콜은 숫자로 구별된다. **시스템 콜 인터페이스(System Call Interface)** 가 이 숫자에 따라 매핑된 테이블을 유지한다. **시스템 콜 테이블(System Call Table)** 은 메모리 주소의 모음인데, 해당 메모리 주소는 인터럽트 서비스 루틴을 가리키고 있다. 시스템 콜 인터페이스는 OS 커널에서 의도된 시스템 콜을 발생시키고, 시스템 콜의 상태나 기타 값들을 반환한다. 호출자(Caller)는 시스템 콜이 어떻게 구현되는지 알 필요는 없고, 어떻게 API를 사용하는지, 시스템 콜의 결과로 OS가 어떤 작업을 하는지만 알면 된다.

![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FcZikqa%2Fbtrd7T7Cqxc%2FgNvZIIhCjILDnD3GEBONp1%2Fimg.png)

시스템 콜을 호출할 때는 OS나 콜의 종류에 따라 요구되는 정보의 양이 다양하다. OS에 변수(Parameter)를 넘겨주는 방법으로 흔히 사용되는 세 방법이 있다.

1. **Call by value** : 가장 단순한 방법, 레지스터에 바로 변수를 넘겨주는 방식이다.
2. **Call by reference** : 만약 변수가 레지스터보다 더 많은 경우는, 블록(block)이나 테이블(Table)에 저장한 후 저장된 주소를 레지스터에 변수로 넘겨주는 방식이다.
3. **스택에 변수를 저장**

2, 3의 방식은 변수의 개수에 제한이 없다.

<br/>

## 시스템 콜의 종류

1. 프로세스 제어(Process Control) : 프로세스 특권 모드를 사용해 직접적으로 프로세스 제어가 가능

2. 파일 조작(File Management) : 파일을 생성하거나 삭제, 관리 등
3. 장치 관리(Device Management) : 장치 요구 및 장치 해제, 읽기, 쓰기, 재배치 등
4. 정보 유지(Information maintenace) : 시간과 날짜의 설정과 획득, 시스템 자료의 설정과 획득
5. 통신(Communications) : 통신 연결의 생성 및 제거, 메세지의 송수신, 상태 정보 전달 등
6. 보호(Protection)

<br/>

## 시스템 콜 예시

**디스크에서 자료를 읽어오는 시스템 콜이라고 가정**
1. 사용자 프로그램이 시스템 콜을 하게 되면 운영체제는 자신의 커널 영역에 정의된 시스템 콜 처리 코드를 수행한다.
2. CPU가 컨트롤 레지스터를 세팅해 디스크 컨트롤러에게 데이터를 읽어오라고 명령한다.
3. 디스크 컨트롤러는 디스크로부터 데이터를 읽어와서 자신의 로컬 버퍼에 저장한다.
4. 작업이 완료되면 디스크 컨트롤러가 CPU에게 인터럽트를 발생시켜 입출력 작업이 완료되었음을 통지한다.

통상적으로 시스템 콜은 여러 종류의 기능으로 나뉘어져 있다. 각 시스템 콜에는 번호가 할당되고 시스템 콜 인터페이스는 이러한 번호에 따라 인덱스되는 테이블을 유지한다. 아래 그림은 open() 시스템 콜을 호출했을 때, 운영체제에서 어떻게 처리되는지를 보여준다.

![](https://camo.githubusercontent.com/75e349e40f6d2d21b1c3b32b353cba1697d61c30202756409a7b876ea13a5663/68747470733a2f2f74312e6461756d63646e2e6e65742f6366696c652f746973746f72792f323533333332343135333543434545383130)

<br/>

**[참조]**
* [원본링크1](https://github.com/WooVictory/Ready-For-Tech-Interview/blob/master/Operating%20System/%EC%8B%9C%EC%8A%A4%ED%85%9C%20%EC%BD%9C(System%20Call).md)
* [원본링크2](https://rebro.kr/171?category=504670)
* [시스템 콜(System Call)](https://fjvbn2003.tistory.com/306)